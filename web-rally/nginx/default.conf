server {
  listen 3003;
  root /usr/share/nginx/html;
  index index.html index.htm;
  port_in_redirect off;

  # Cache-control: ensure HTML is not cached; assets can be long-cached
  location = /rally/index.html {
    add_header Cache-Control "no-store";
  }

  # Static assets must never fall back to index.html; return 404 if missing
  location ^~ /rally/assets/ {
    try_files $uri =404;
    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  location /rally {
    try_files $uri $uri/ /rally/index.html;
  }
}
